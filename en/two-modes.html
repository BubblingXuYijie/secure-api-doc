<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <style>
      :root {
        --c-bg: #fff;
      }

      html.dark {
        --c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <link rel="icon" href="https://qiniuoss.xuyijie.icu/SecureApiDoc/img/logo/favicon.png"><title>Two Modes | SecureApi Document</title><meta name="description" content="A spring boot interface parameters and return value encryption and decryption tool">
    <link rel="preload" href="/secure-api-doc/assets/style-BTWLNjuB.css" as="style"><link rel="stylesheet" href="/secure-api-doc/assets/style-BTWLNjuB.css">
    <link rel="modulepreload" href="/secure-api-doc/assets/app-Bdk9ciYo.js"><link rel="modulepreload" href="/secure-api-doc/assets/two-modes.html-hBhCQaT3.js">
    <link rel="prefetch" href="/secure-api-doc/assets/CipherUtils.html-XgSuW5m7.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/DH密钥协商.html-C6qcTAKu.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/JS示例.html-B-Q3WgKq.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/index.html-yvH-znDu.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/URL匹配.html-Bjp40_mT.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/两种模式.html-D4Vp8BBM.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/加密算法.html-r_4L4ZBy.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/安装.html-C7CB_ZOk.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/开始使用.html-jiNuy0Zg.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/异常处理.html-BSkcLTaK.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/微服务调用.html-CjUGS4Fy.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/注解.html-DR3YEnsy.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/版本历史.html-BXn7_4DX.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/试一下.html-DNs8cwk0.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/配置.html-CH_kjaWO.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/黑金刚.html-CDKvSyFi.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/CipherUtils.html-Dpgq-tNP.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/DH-key-agreement.html-D33sETEN.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/index.html-Mwvo4oYt.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/annotation.html-L9k9azFR.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/black-king-kong.html-C1z6nI36.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/configuration.html-CRXod4jy.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/encryption-algorithm.html-jRJPZYP7.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/exception-handle.html-Ypekad5G.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/get-started.html-Xv-Zkwqk.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/install.html-B9AexQhd.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/js-demo.html-BQfQAWrf.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/microservice-invocation.html-Rh4CGjwr.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/try-it.html-CTFIi6Vj.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/url-pattern.html-aYWN-Cc2.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/version-history.html-DJzWivzD.js" as="script"><link rel="prefetch" href="/secure-api-doc/assets/404.html-cxtPVgHV.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon"><!--[--><header class="vp-navbar"><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/secure-api-doc/en/"><img class="vp-site-logo" src="https://qiniuoss.xuyijie.icu/SecureApiDoc/img/logo/logo.png" alt="SecureApi Document"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">SecureApi Document</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/secure-api-doc/en/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/secure-api-doc/en/get-started.html" aria-label="Get Start"><!---->Get Start<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/secure-api-doc/en/version-history.html" aria-label="Version History"><!---->Version History<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Doc Accelerate"><span class="title">Doc Accelerate</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Doc Accelerate"><span class="title">Doc Accelerate</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://doc.xuyijie.icu/secure-api-doc/" aria-label="China Mainland" rel="noopener noreferrer" target="_blank"><!---->China Mainland<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://bubblingxuyijie.github.io/secure-api-doc/" aria-label="International" rel="noopener noreferrer" target="_blank"><!---->International<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">切换语言</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">切换语言</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/secure-api-doc/" aria-label="简体中文"><!---->简体中文<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/secure-api-doc/en/two-modes.html" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar"><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/secure-api-doc/en/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/secure-api-doc/en/get-started.html" aria-label="Get Start"><!---->Get Start<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/secure-api-doc/en/version-history.html" aria-label="Version History"><!---->Version History<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Doc Accelerate"><span class="title">Doc Accelerate</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Doc Accelerate"><span class="title">Doc Accelerate</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://doc.xuyijie.icu/secure-api-doc/" aria-label="China Mainland" rel="noopener noreferrer" target="_blank"><!---->China Mainland<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://bubblingxuyijie.github.io/secure-api-doc/" aria-label="International" rel="noopener noreferrer" target="_blank"><!---->International<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">切换语言</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">切换语言</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/secure-api-doc/" aria-label="简体中文"><!---->简体中文<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/secure-api-doc/en/two-modes.html" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/secure-api-doc/en/get-started.html" aria-label="Start"><!---->Start<!----></a><!----></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Guide <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/secure-api-doc/en/install.html" aria-label="Install"><!---->Install<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secure-api-doc/en/configuration.html" aria-label="Configuration"><!---->Configuration<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secure-api-doc/en/try-it.html" aria-label="Try It"><!---->Try It<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secure-api-doc/en/annotation.html" aria-label="Annotation"><!---->Annotation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secure-api-doc/en/url-pattern.html" aria-label="Url Pattern"><!---->Url Pattern<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secure-api-doc/en/exception-handle.html" aria-label="Exception Handle"><!---->Exception Handle<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secure-api-doc/en/encryption-algorithm.html" aria-label="Encryption Algorithm"><!---->Encryption Algorithm<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secure-api-doc/en/CipherUtils.html" aria-label="CipherUtils"><!---->CipherUtils<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/secure-api-doc/en/two-modes.html" aria-label="Two Modes"><!---->Two Modes<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secure-api-doc/en/DH-key-agreement.html" aria-label="DH Key Agreement"><!---->DH Key Agreement<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/secure-api-doc/en/js-demo.html" aria-label="Js Demo"><!---->Js Demo<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/secure-api-doc/en/microservice-invocation.html" aria-label="Microservice Invocation"><!---->Microservice Invocation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/secure-api-doc/en/black-king-kong.html" aria-label="Black King Kong"><!---->Black King Kong<!----></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="two-modes" tabindex="-1"><a class="header-anchor" href="#two-modes"><span>Two Modes</span></a></h1><h2 id="introduce" tabindex="-1"><a class="header-anchor" href="#introduce"><span>Introduce</span></a></h2><p>In the encryption modes introduced in the previous chapter, there are <code>common</code> and <code>session-key</code>. Let&#39;s start with the conclusion that <code>common</code> is more convenient and <code>session-key</code> is more secure.</p><h2 id="common-mode" tabindex="-1"><a class="header-anchor" href="#common-mode"><span>common mode</span></a></h2><p><code>commom</code> mode, both the front and back ends need to save the same key or key pair for deciphering.(Interface encryption is not limited to the front and back ends, but can also be used to communicate between two servers. Here is an example of the front and back ends.)</p><blockquote><p>Example:</p><ul><li>SecureApi sets the encryption algorithm to <code>AES</code>, generates a key, you can wait for the component to automatically generate or use <code>CipherUtils</code> to generate, or you can use the online website to generate, and then save it in the <code>key</code> field of the <code>SecureApiPropertiesConfig</code>, the front end also saves this key, the front end sends the data encrypted with the key to the back end, and the backend uses the key to decipher after receiving it.</li></ul><p>Disadvantage:</p><ul><li>There is a risk of leakage on the front end of the key (the client end is hacked and debugged by F12)</li><li>The key cannot be dynamically generated, and the front and back ends need to discuss their respective hardcode/hard coding (plaintext keys are more dangerous to transmit in the network than to store in the front end, and services that require interface encryption will never allow you to transmit plaintext keys in the network)</li></ul><p>Advantage:</p><ul><li>Simple implementation, no need to worry about key agreement</li><li>High performance, a copy of the key is kept on the front and back ends, no additional network communication is required to negotiate the key</li></ul></blockquote><h2 id="session-key-mode" tabindex="-1"><a class="header-anchor" href="#session-key-mode"><span>session-key mode</span></a></h2><p>The <code>session-key</code> mode requires both the <code>RSA</code> and <code>symmetric encryption algorithm</code> to cooperate with the implementation. The front end generates a new <code>symmetric encryption key</code> for each request (the key can also be updated every once in a while), and then uses this key to encrypt the data, and then uses the <code>RSA</code> public key to encrypt the key. The encrypted data and key are transmitted to the backend. The backend uses the <code>RSA</code> private key decipher to get the <code>session key</code>. Using the <code>session key</code> decipher data, the return value is relatively simple. Just use the <code>session key</code> to encrypt the return value to the front end. The front end uses <code>session key</code> decipher on it.</p><blockquote><p>Example：</p><ul><li>Backend Use SecureApi to set the encryption mode to <code>session-key</code>, specify the encryption algorithm to <code>RSA</code>, specify the session key encryption algorithm to <code>AES</code>, generate an <code>RSA</code> key pair, saved in the <code>publicKey</code> and <code>privateKey</code> fields of <code>SecureApiPropertiesConfig</code></li><li>The first communication: the front end requests the <code>RSA</code> public key of the back end</li><li>Second communication: The front end uses the backend <code>RSA</code> public key to encrypt any data, and transmits the encrypted data to the backend. The backend uses its own <code>RSA</code> private key decipher. If the decryption is successful, tell the front end that the verification is successful. If the decipher fails, in addition to the code reason, it means that the first communication public key was tampered with during transmission, and the <code>RSA</code> key pair needs to be regenerated for re-verification</li><li>After the verification is successful, the subsequent interface encryption method is: the front end generates a <code>session key</code> for the request, encrypts the data with the <code>session key</code>, and then uses the backend <code>RSA</code> public key to encrypt the <code>session key</code>, and transmits the encrypted data and key to the backend. The backend can write an interception device and save the <code>session key</code> to the <code>key</code> field of the SecureApiPropertiesConfig (no need to decipher by itself). SecureApi will automatically use the <code>RSA</code> private key decipher to get the <code>session key</code>. Subsequent SecureApi will also automatically use the <code>session key</code> decipher and encryption Data</li><li>You can generate a different session key for each request, and you can update the key regularly. The RSA key pair on the backend can also be updated periodically to enhance security</li></ul><p>Disadvantage：</p><ul><li>As you can see, the process is more complicated</li><li>Generating a new key per request and decrypting the key with the <code>RSA</code> private key in the backend will obviously result in more performance loss</li></ul><p>Advantage：</p><ul><li>Safe, safe, and the fuck safe</li></ul></blockquote><p>With the help of SecureApi implementation of the <code>session-key</code> mode, only the following two simple files are required:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="SecureApi config file"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">SecureApiPropertiesConfig</span> <span class="token function">secureApiPropertiesConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">SecureApiPropertiesConfig</span> secureApiPropertiesConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureApiPropertiesConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// Set mode as session-key</span></span>
<span class="line">    secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setMode</span><span class="token punctuation">(</span><span class="token class-name">SecureApiProperties<span class="token punctuation">.</span>Mode</span><span class="token punctuation">.</span><span class="token constant">SESSION_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// Set session key cipher algorithm</span></span>
<span class="line">    secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setSessionKeyCipherAlgorithm</span><span class="token punctuation">(</span><span class="token class-name">CipherAlgorithmEnum</span><span class="token punctuation">.</span><span class="token constant">AES_ECB_PKCS5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// Session-key mode The encryption algorithm must be set to RSA</span></span>
<span class="line">    secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setCipherAlgorithmEnum</span><span class="token punctuation">(</span><span class="token class-name">CipherAlgorithmEnum</span><span class="token punctuation">.</span><span class="token constant">RSA_ECB_SHA256</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// The key can not be set, the component will automatically generate one and print it on the console. If you need to generate it manually, you only need to use the CipherUtils provided by the component</span></span>
<span class="line">    <span class="token class-name">CipherUtils</span> cipherUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CipherUtils</span><span class="token punctuation">(</span><span class="token class-name">CipherAlgorithmEnum</span><span class="token punctuation">.</span><span class="token constant">RSA_ECB_SHA256</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// The seed parameter can be passed in getRandomRsaKeyPair(&quot;1&quot;), which can be used to control the same key generated each time during testing</span></span>
<span class="line">    <span class="token class-name">RsaKeyPair</span> randomRsaKeyPair <span class="token operator">=</span> cipherUtils<span class="token punctuation">.</span><span class="token function">getRandomRsaKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// Set the generated key pair to secureApiPropertiesConfig</span></span>
<span class="line">    secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setPublicKey</span><span class="token punctuation">(</span>randomRsaKeyPair<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span>randomRsaKeyPair<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> secureApiPropertiesConfig<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the interception, set the session key of each request to the <code>key</code> value of the <code>secureApiPropertiesConfig</code>, and all subsequent operations are automatically completed by SecureApi.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="SessionKey interceptor"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecureKeyInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SecureKeyInterceptor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">SecureApiPropertiesConfig</span> secureApiPropertiesConfig<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Here you only need to modify the key value of the secureApiPropertiesConfig in the interception, and the subsequent operations are all done automatically by SecureApi</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">SecureApiProperties<span class="token punctuation">.</span>Mode</span><span class="token punctuation">.</span><span class="token constant">SESSION_KEY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> sessionKey <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;sessionKey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;session key transmitted from the front: {}&quot;</span><span class="token punctuation">,</span> sessionKey<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setKey</span><span class="token punctuation">(</span>sessionKey<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/BubblingXuYijie/secure-api-doc/edit/main/docs/en/two-modes.md" aria-label="Edit on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1119461672@qq.com">XuYijie</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/secure-api-doc/en/CipherUtils.html" aria-label="CipherUtils"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>CipherUtils</span></div></a><a class="route-link auto-link next" href="/secure-api-doc/en/DH-key-agreement.html" aria-label="DH Key Agreement"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>DH Key Agreement</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/secure-api-doc/assets/app-Bdk9ciYo.js" defer></script>
  </body>
</html>
