import{_ as n,c as a,a as e,o as p}from"./app-CXRzL9wg.js";const t={};function c(i,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h1><p>有两种配置方法， <code>yml</code> 和 <code>Bean</code> 方式，看你喜欢哪一个，如果是对安全性要求较高，建议使用 <code>Bean</code> 方式动态设置密钥，而不是写在 <code>yml</code> 里。</p><h2 id="yml模式" tabindex="-1"><a class="header-anchor" href="#yml模式"><span>yml模式</span></a></h2><blockquote><p>下面是 <code>yml</code> 的完整配置，有些配置项是可选的，在注解中均已解释</p></blockquote><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">secure-api</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># 开启SecureApi功能，如果为false则其余配置项均不生效</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token comment"># 开启接口数据数字签名校验</span></span>
<span class="line">  <span class="token key atrule">sign-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">  <span class="token comment"># 生成的key和密文等是否是符合url规范的，默认开启，开启后与前端配合时前端要自行处理密文的 url safe 转换，在 &quot;JS示例&quot; 篇有代码示例</span></span>
<span class="line">  <span class="token key atrule">url-safe</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token comment"># 开启加解密日志打印，会打印出接口名、加密模式、算法、明文和密文等信息</span></span>
<span class="line">  <span class="token key atrule">show-log</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token comment"># 加密模式，common和session_key可选，session_key是会话密钥模式，用于每次请求都使用不同的密钥，需要前端配合</span></span>
<span class="line">  <span class="token key atrule">mode</span><span class="token punctuation">:</span> common</span>
<span class="line">  <span class="token comment"># 加密算法</span></span>
<span class="line">  <span class="token key atrule">cipher-algorithm</span><span class="token punctuation">:</span> rsa_ecb_sha256</span>
<span class="line">  <span class="token comment"># session_key模式配置项，与前端协商的会话密钥类型，common模式下此配置不生效</span></span>
<span class="line">  <span class="token key atrule">session-key-cipher-algorithm</span><span class="token punctuation">:</span> aes_ecb_pkcs5</span>
<span class="line">  <span class="token comment"># 对称算法用于加解密的密钥，Base64格式，cipher-algorithm选择对称加密算法时配置，也可为空，组件会随机生成一个</span></span>
<span class="line">  <span class="token key atrule">key</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># 对称算法用于加解密的偏移量，Base64格式，cipher-algorithm选择对称加密算法时配置，也可为空，组件会随机生成一个</span></span>
<span class="line">  <span class="token key atrule">iv</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># 非对称算法用于加密的公钥，Base64格式，cipher-algorithm选择RSA非对称加密算法时配置，也可为空，组件会随机生成一对</span></span>
<span class="line">  <span class="token key atrule">public-key</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># 非对称算法用于解密的私钥，Base64格式，cipher-algorithm选择RSA非对称加密算法时配置，也可为空，组件会随机生成一对</span></span>
<span class="line">  <span class="token key atrule">private-key</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># 开启接口数字签名校验后可以配置数字签名RSA公钥，也可为空，组件会随机生成一对</span></span>
<span class="line">  <span class="token key atrule">sign-public-key</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># 开启接口数字签名校验后可以配置数字签名RSA私钥，也可为空，组件会随机生成一对</span></span>
<span class="line">  <span class="token key atrule">sign-private-key</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># String类型，统一返回体中需要加密的data字段名，配置以后返回值只加密自定义返回体中的指定字段，例如配置为 data</span></span>
<span class="line">  <span class="token key atrule">response-body-data-field</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># 需要加密的接口路径匹配，遵循spring boot拦截器的正则规则，留空或者不配置代表不使用url匹配，只对注解的接口进行解密</span></span>
<span class="line">  <span class="token key atrule">encrypt-url</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 配置了此项，接口有无注解都将进行返回值加密</span></span>
<span class="line">    <span class="token key atrule">include-urls</span><span class="token punctuation">:</span> /<span class="token important">**</span></span>
<span class="line">    <span class="token comment"># 即使配置了排除，注解的优先级也高于此项</span></span>
<span class="line">    <span class="token key atrule">exclude-urls</span><span class="token punctuation">:</span> /test1<span class="token punctuation">,</span>/test2</span>
<span class="line">  <span class="token comment"># 需要解密的接口路径匹配，遵循spring boot拦截器的正则规则，留空或者不配置代表不使用url匹配，只对注解的接口、参数、字段进行解密</span></span>
<span class="line">  <span class="token key atrule">decrypt-url</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 配置了此项，接口、参数、字段有无注解都将进行解密</span></span>
<span class="line">    <span class="token key atrule">include-urls</span><span class="token punctuation">:</span> /<span class="token important">**</span></span>
<span class="line">    <span class="token comment"># 即使配置了排除，注解的优先级也高于此项</span></span>
<span class="line">    <span class="token key atrule">exclude-urls</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># Date类型日期格式化</span></span>
<span class="line">  <span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss</span>
<span class="line">  <span class="token comment"># LocalDateTime类型日期格式化</span></span>
<span class="line">  <span class="token key atrule">local-date-time-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss</span>
<span class="line">  <span class="token comment"># LocalDate类型日期格式化</span></span>
<span class="line">  <span class="token key atrule">local-date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd</span>
<span class="line">  <span class="token comment"># LocalTime类型日期格式化</span></span>
<span class="line">  <span class="token key atrule">local-time-format</span><span class="token punctuation">:</span> HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="bean方式" tabindex="-1"><a class="header-anchor" href="#bean方式"><span>Bean方式</span></a></h2><blockquote><p>注意，一旦使用了 <code>Bean</code> 方式来配置，<code>yml</code> 里的配置项都将失效</p></blockquote><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">icu<span class="token punctuation">.</span>xuyijie<span class="token punctuation">.</span>secureapi<span class="token punctuation">.</span>cipher<span class="token punctuation">.</span></span><span class="token class-name">CipherAlgorithmEnum</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">icu<span class="token punctuation">.</span>xuyijie<span class="token punctuation">.</span>secureapi<span class="token punctuation">.</span>cipher<span class="token punctuation">.</span></span><span class="token class-name">CipherUtils</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">icu<span class="token punctuation">.</span>xuyijie<span class="token punctuation">.</span>secureapi<span class="token punctuation">.</span>cipher<span class="token punctuation">.</span></span><span class="token class-name">RsaKeyPair</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">icu<span class="token punctuation">.</span>xuyijie<span class="token punctuation">.</span>secureapi<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">SecureApiProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">icu<span class="token punctuation">.</span>xuyijie<span class="token punctuation">.</span>secureapi<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">SecureApiPropertiesConfig</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringBootConfiguration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootConfiguration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecureApiConfig</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 这里的配置了Bean会导致yml配置的数据失效</span>
<span class="line">     * <span class="token keyword">@return</span> SecureApiPropertiesConfig</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">SecureApiPropertiesConfig</span> <span class="token function">secureApiPropertiesConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SecureApiPropertiesConfig</span> secureApiPropertiesConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureApiPropertiesConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 生成的key和密文是符合url规范的，默认开启，开启后与前端配合时前端要自行处理密文的 url safe 转换，在 &quot;JS示例&quot; 篇有代码示例</span></span>
<span class="line">        secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setUrlSafe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setShowLog</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setMode</span><span class="token punctuation">(</span><span class="token class-name">SecureApiProperties<span class="token punctuation">.</span>Mode</span><span class="token punctuation">.</span><span class="token constant">COMMON</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setCipherAlgorithmEnum</span><span class="token punctuation">(</span><span class="token class-name">CipherAlgorithmEnum</span><span class="token punctuation">.</span><span class="token constant">RSA_ECB_SHA256</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 密钥可以不设置，组件会自动生成一个，并打印在控制台，如果需要手动生成，只需要使用组件提供的CipherUtils</span></span>
<span class="line">        <span class="token class-name">CipherUtils</span> cipherUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CipherUtils</span><span class="token punctuation">(</span><span class="token class-name">CipherAlgorithmEnum</span><span class="token punctuation">.</span><span class="token constant">RSA_ECB_SHA256</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 因为我们选择的是非对称加密RSA，所以生成一个密钥对，getRandomRsaKeyPair(&quot;1&quot;)可传入seed参数，在测试时可用于控制每次生成的密钥相同</span></span>
<span class="line">        <span class="token class-name">RsaKeyPair</span> randomRsaKeyPair <span class="token operator">=</span> cipherUtils<span class="token punctuation">.</span><span class="token function">getRandomRsaKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 把生成的密钥对设置到secureApiPropertiesConfig</span></span>
<span class="line">        secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setPublicKey</span><span class="token punctuation">(</span>randomRsaKeyPair<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span>randomRsaKeyPair<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 配置数字签名校验密钥对</span></span>
<span class="line">        <span class="token class-name">RsaKeyPair</span> randomRsaKeyPair2 <span class="token operator">=</span> cipherUtils<span class="token punctuation">.</span><span class="token function">getRandomRsaKeyPair</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setSignPublicKey</span><span class="token punctuation">(</span>randomRsaKeyPair2<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        secureApiPropertiesConfig<span class="token punctuation">.</span><span class="token function">setSignPrivateKey</span><span class="token punctuation">(</span>randomRsaKeyPair2<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 不需要使用url匹配功能可以删除掉下面两行，或者传入空数组</span></span>
<span class="line">        <span class="token comment">// secureApiPropertiesConfig.setEncryptUrl(new SecureApiProperties.UrlPattern(Arrays.asList(&quot;/**&quot;), new ArrayList&lt;&gt;()));</span></span>
<span class="line">        <span class="token comment">// secureApiPropertiesConfig.setDecryptUrl(new SecureApiProperties.UrlPattern(Arrays.asList(&quot;/**&quot;), Arrays.asList(&quot;/secureApiTest/testForm&quot;)));</span></span>
<span class="line">        <span class="token keyword">return</span> secureApiPropertiesConfig<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8)])])}const o=n(t,[["render",c]]),u=JSON.parse('{"path":"/%E9%85%8D%E7%BD%AE.html","title":"配置","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1765002247000,"contributors":[{"name":"XuYijie","username":"XuYijie","email":"1119461672@qq.com","commits":10,"url":"https://github.com/XuYijie"},{"name":"XuYijie(Bubble)","username":"","email":"1119461672@qq.com","commits":1}],"changelog":[{"hash":"0ffdc3d0926751f5f1a77d98fd43d95834949798","time":1765002247000,"email":"1119461672@qq.com","author":"XuYijie(Bubble)","message":"Update documentation for digital signature handling and adjust development dependencies to latest versions."},{"hash":"67e0df2406d4b03bc742f1cce3d20a2c4eb70e0a","time":1742975129000,"email":"1119461672@qq.com","author":"XuYijie","message":"文档修改"},{"hash":"84c0239a289703d5f5e42d48187e47f9073bfa45","time":1724921846000,"email":"1119461672@qq.com","author":"XuYijie","message":"更新文档"},{"hash":"d17fdb50ece47491c539f91b1c13a011f6a9602a","time":1723002031000,"email":"1119461672@qq.com","author":"XuYijie","message":"更新文档"},{"hash":"f843761f5046396a17ca36546eed37ed555b29bc","time":1721630560000,"email":"1119461672@qq.com","author":"XuYijie","message":"完善文档"},{"hash":"18e7f6c732df94a21872307fc2d7f8f16291cb66","time":1721630524000,"email":"1119461672@qq.com","author":"XuYijie","message":"完善文档"},{"hash":"f435896379da2dc2b9d3d7a23340057ea3134504","time":1721630446000,"email":"1119461672@qq.com","author":"XuYijie","message":"完善文档"},{"hash":"bf31648a37e7a9bcc4ba58f6fadbfa83ac64ec3b","time":1720505503000,"email":"1119461672@qq.com","author":"XuYijie","message":"完善文档"},{"hash":"9c910a8755ef3c8c920329c7efeb2b9feea70573","time":1719820775000,"email":"1119461672@qq.com","author":"XuYijie","message":"完善文档"},{"hash":"be5bf9c0b8ed7756292b7021381269fb007c8519","time":1719467328000,"email":"1119461672@qq.com","author":"XuYijie","message":"完善文档"},{"hash":"f8fa1f2b4abeb27bb31d82be5019e7575445b3fb","time":1719406391000,"email":"1119461672@qq.com","author":"XuYijie","message":"完善文档"}]},"filePathRelative":"配置.md"}');export{o as comp,u as data};
