import{_ as n}from"./DH密钥协商工具类示例输出-B0hvIEJX.js";import{_ as e,c as s,o as a,a as t}from"./app-AoRMf6eq.js";const o={},i=t(`<h1 id="dh-key-agreement" tabindex="-1"><a class="header-anchor" href="#dh-key-agreement"><span>DH Key Agreement</span></a></h1><h2 id="introduce" tabindex="-1"><a class="header-anchor" href="#introduce"><span>Introduce</span></a></h2><p>The client end and server level generate their own <code>RSA</code> key pairs and exchange public keys, using <code>Diffie Hellman</code>. The algorithm uses its own private key and the other party&#39;s public key, and the client end and server level will generate the same <code>AES</code> symmetric encryption key, Later, the client end and the server verify the negotiated key, and the successful verification uses the <code>AES</code> key to add to decipher, because the key has never been exposed on the network, so it is safe.</p><h2 id="negotiation-process" tabindex="-1"><a class="header-anchor" href="#negotiation-process"><span>Negotiation process</span></a></h2><p>To use DH key negotiation, the backend needs to use SecureApi to set the encryption mode to <code>common</code> and specify the encryption algorithm as <code>AES</code>, which cannot be other algorithms, because DH The negotiated key is the key of <code>AES</code>.</p><blockquote><ul><li>The backend uses <code>CipherUtils</code> or an online website to generate a <code>RSA</code> key pair and save it on the server, waiting for the front-end negotiation signal</li><li>The first communication: the front-end generates the <code>RSA</code> key pair, then sends a request for the negotiated key to the back-end, and sends the public key to the front-end (the public key is transmitted on the network, and will be checked later). After the backend receives the request, it uses its own private key and the public key sent from the front-end to generate a <code>negotiated key</code> and save it in the <code>key</code> field of the <code>SecureApiPropertiesConfig</code>, and then returns its own public key to the front-end. After the front-end gets the backend public key, it also uses this public key and its own private key to generate a <code>negotiated key</code></li><li>Second communication: The front end uses the <code>negotiation key</code> to encrypt an arbitrary data and send it to the backend. The backend sees if the <code>negotiation key</code> can be used to successfully decipher. If it succeeds, the negotiation is successful. The subsequent front and back ends use the <code>negotiation key</code> to add to decipher. If the decipher fails, in addition to the code reason, it may be that the <code>public key</code> was tampered with during transmission. At this time, it needs to be renegotiated</li><li>After the negotiation is successful, the front and back ends each have the same symmetric key, which can be used to add a decipher later. This key has never been exposed on the network, so it is safe. You can also renegotiate regularly to enhance security</li></ul></blockquote><h2 id="advantage" tabindex="-1"><a class="header-anchor" href="#advantage"><span>Advantage</span></a></h2><ul><li>Security, although it is still a little worse than the <code>session-key</code> mode, the negotiation process is simpler than the <code>session-key</code> mode</li><li>Compared with the <code>session-key</code> mode, each request has one less calculation of the <code>RSA</code> private key decipher session key, and the performance is higher (do not underestimate the performance consumption of the private key decipher)</li></ul><h2 id="diffiehellmanutils" tabindex="-1"><a class="header-anchor" href="#diffiehellmanutils"><span>DiffieHellmanUtils</span></a></h2><p>SecureApi provides a tool class for DH key negotiation: <code>DiffieHellmanUtils</code>, the following is an introduction to the method of the tool class.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// The backend generates a DH key pair and sends the public key to the frontend</span></span>
<span class="line">    <span class="token class-name">KeyPair</span> serverKeyPair <span class="token operator">=</span> <span class="token class-name">DiffieHellmanUtils</span><span class="token punctuation">.</span><span class="token function">getDhKeyPairs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// The front end generates the key pair and sends the public key to the backend.</span></span>
<span class="line">    <span class="token class-name">KeyPair</span> clientKeyPair <span class="token operator">=</span> <span class="token class-name">DiffieHellmanUtils</span><span class="token punctuation">.</span><span class="token function">getDhKeyPairs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// The backend generates a negotiated key based on its own private key and the frontend public key</span></span>
<span class="line">    <span class="token class-name">String</span> serverSharedSecretString <span class="token operator">=</span> <span class="token class-name">DiffieHellmanUtils</span><span class="token punctuation">.</span><span class="token function">createSharedSecret</span><span class="token punctuation">(</span>serverKeyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> clientKeyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// The front end generates a negotiated key based on its own private key and the backend public key</span></span>
<span class="line">    <span class="token class-name">String</span> clientSharedSecretString <span class="token operator">=</span> <span class="token class-name">DiffieHellmanUtils</span><span class="token punctuation">.</span><span class="token function">createSharedSecret</span><span class="token punctuation">(</span>clientKeyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> serverKeyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Server shared key：&quot;</span> <span class="token operator">+</span> serverSharedSecretString<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Client shared key：&quot;</span> <span class="token operator">+</span> clientSharedSecretString<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Is it the same: &quot;</span> <span class="token operator">+</span> clientSharedSecretString<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>serverSharedSecretString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 使用共享密钥加密</span></span>
<span class="line">    <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;Hello, 你 好/、\\\\！&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">CipherUtils</span> cipherUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CipherUtils</span><span class="token punctuation">(</span><span class="token class-name">CipherAlgorithmEnum</span><span class="token punctuation">.</span><span class="token constant">AES_ECB_PKCS5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> encrypt <span class="token operator">=</span> cipherUtils<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> serverSharedSecretString<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;After encryption: &quot;</span> <span class="token operator">+</span> encrypt<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 使用共享密钥解密</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;After decryption: &quot;</span> <span class="token operator">+</span> cipherUtils<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypt<span class="token punctuation">,</span> serverSharedSecretString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+n+'" alt="output result" tabindex="0" loading="lazy"><figcaption>output result</figcaption></figure><h2 id="explain" tabindex="-1"><a class="header-anchor" href="#explain"><span>Explain</span></a></h2><p>The essence of DH key agreement is to save a key for each front and back end, but to enhance the flexibility, SecureApi still uses the <code>common</code> mode, and the negotiated key is set to the <code>key</code> field of the <code>SecureApiPropertiesConfig</code> when configuring SecureApi.</p>',14),c=[i];function p(l,r){return a(),s("div",null,c)}const k=e(o,[["render",p],["__file","DH-key-agreement.html.vue"]]),h=JSON.parse('{"path":"/en/DH-key-agreement.html","title":"DH Key Agreement","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Introduce","slug":"introduce","link":"#introduce","children":[]},{"level":2,"title":"Negotiation process","slug":"negotiation-process","link":"#negotiation-process","children":[]},{"level":2,"title":"Advantage","slug":"advantage","link":"#advantage","children":[]},{"level":2,"title":"DiffieHellmanUtils","slug":"diffiehellmanutils","link":"#diffiehellmanutils","children":[]},{"level":2,"title":"Explain","slug":"explain","link":"#explain","children":[]}],"git":{"updatedTime":1719482259000,"contributors":[{"name":"XuYijie","email":"1119461672@qq.com","commits":2}]},"filePathRelative":"en/DH-key-agreement.md"}');export{k as comp,h as data};
